<html>
<head>
  <script>
    // Load native UI library
    var gui = require('nw.gui'); //or global.window.nwDispatcher.requireNwGui() (see https://github.com/rogerwang/node-webkit/issues/707)

    // Get the current window
    var win = gui.Window.get();

    win.hide();

    var gui = require('nw.gui');

    // Create a tray icon
    var tray = new gui.Tray({ icon: 'img/grey.png' });

    // Give it a menu
    var menu = new gui.Menu();
    menu.append(new gui.MenuItem({
      label: 'Quit',
      click: function() {
        gui.App.quit();
      }
    }));
    tray.menu = menu;

    var net = require('net');
    var server = net.createServer(function(c) {
      c.setEncoding('ascii');

      c.on('data', function(data) {
        var imageName;

        data = data.replace('\n', '');

        c.end();

        switch (data) {
          case "stop":
            server.close();
            gui.App.quit();
            break;
          case "0":
            imageName = "img/grey.png"
            break;
          case "1":
            imageName = "img/red.png"
            break;
          case "2":
            imageName = "img/green.png"
            break;
          case "3":
            imageName = "img/yellow.png"
            break;
          default:
            return;
        }

        tray.icon = imageName;
      });
    });

    server.listen(17357);
  </script>
</head>
<body>
  Should not be visible.
</body>
</html>
