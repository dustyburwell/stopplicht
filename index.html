<html>
<head>
  <script>
    var net = require('net');
    var gui = require('nw.gui');
    var tray;

    var server = net.createServer(function(c) {
      c.setEncoding('ascii');

      c.on('data', function(data) {
        var imageName;

        data = data.replace('\n', '');
        data = data.split(' ');
        command = data[0];
        message = data.slice(1).join(' ');

        c.end();

        switch (command) {
          case "stop":
            server.close();
            gui.App.quit();
            break;
          case "0":
            imageName = "img/grey.png"
            break;
          case "1":
            imageName = "img/red.png"
            break;
          case "2":
            imageName = "img/green.png"
            break;
          case "3":
            imageName = "img/yellow.png"
            break;
          default:
            return;
        }

        if (message) {
          var notif = new Notification(message, {icon: imageName});
        }

        tray.icon = imageName;
      });
    });

    server.listen(17357, function() {
      // Get the current window
      var win = gui.Window.get();

      win.hide();

      // Create a tray icon
      tray = new gui.Tray({ icon: 'img/grey.png' });

      // Give it a menu
      var menu = new gui.Menu();
      menu.append(new gui.MenuItem({
        label: 'Quit',
        click: function() {
          gui.App.quit();
        }
      }));
      tray.menu = menu;
    });

    server.on('error', function() {
      gui.App.quit();
    })
  </script>
</head>
<body>
  Should not be visible.
</body>
</html>
